<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link rel="icon" href="/assets/icons/scroll-favicon.svg" type="image/x-icon">
    <link href="/src/css/output.css" rel="stylesheet">
    <link href="/src/css/custom.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="/src/javascript/scripts.js"></script>

    <title>Battle Royale Game</title>
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KEGQVW1PYF"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-KEGQVW1PYF');
</script>

<body>

<!-- Header -->
<header class="bg-black text-white p-3">
    <div class="mx-4 md:mx-60">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold hover:text-blue-400">
                <a href="/index.html">Rishi Khanna</a>
            </h1>

            <!-- Desktop Menu -->
            <nav class="hidden md:flex">
                <ul class="flex space-x-4">
                    <li><a class="hover:text-blue-400" href="/index.html">Portfolio</a></li>
                    <li><a class="hover:text-blue-400" href="/pages/resume.html">Resume</a></li>
                    <li><a class="hover:text-blue-400" href="/pages/contact.html">Contact</a></li>
                    <li><a class="hover:text-blue-400" href="https://darkparasite.github.io/GameDevCodex/" target="_blank" rel="noopener noreferrer">GameDevCodex</a></li>
                </ul>
            </nav>

            <!-- Mobile Menu Button -->
            <button id="menu-toggle" class="md:hidden text-2xl">&#9776;</button>
        </div>
    </div>

    <!-- Mobile Menu -->
    <nav id="mobile-menu" class="md:hidden bg-black text-white">
        <ul class="flex flex-col space-y-4 p-4">
            <li><a class="hover:text-blue-400" href="/index.html">Portfolio</a></li>
            <li><a class="hover:text-blue-400" href="/pages/resume.html">Resume</a></li>
            <li><a class="hover:text-blue-400" href="/pages/contact.html">Contact</a></li>
            <li><a class="hover:text-blue-400" href="https://darkparasite.github.io/GameDevCodex/" target="_blank" rel="noopener noreferrer">GameDevCodex</a></li>
        </ul>
    </nav>


    <script>
        // JavaScript to toggle the mobile menu
        document.getElementById('menu-toggle').addEventListener('click', function () {
            let menu = document.getElementById('mobile-menu');
            menu.classList.toggle('open');
        });
    </script>

</header>


<!-- Main Body -->
<div class="flex flex-col items-center w-full h-full bg-gray-100 min-h-screen">

    <!-- Main Box -->
    <div class="bg-white p-6 rounded-lg shadow-xl items-center my-0 md:my-5 w-full md:w-3/4 h-full min-h-screen md:h-auto">

        <!-- Title -->
        <h1 class="text-2xl font-bold mb-1">Battle Royale Game</h1>
        <hr class="border-y border-gray-400 mb-2">

        <!-- Tags -->
        <div class="flex flex-wrap gap-1 mb-2.5 mt-2">
            <span class="bg-blue-200 text-blue-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded">C++</span>
            <span class="bg-blue-200 text-blue-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded">Blueprint</span>
            <span class="bg-red-200 text-red-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded">Multiplayer</span>
            <span class="bg-green-200 text-green-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded">Unreal Engine</span>
        </div>

        <!-- Time Period -->
        <div>
            <p class="text-gray-600 text-sm mb-2"><i class="fa-regular fa-clock"></i> April 2024 - September 2024</p>
        </div>

        <!-- Description and Showcase -->
        <h3 class="font-semibold text-xl mt-5 ">Description and Showcase</h3>
        <hr class="border-y border-gray-400 mb-2 mr-10">
        <div class="my-5">
            <p class="text-gray-800 text-base">
                This is a Battle Royale game, I have developed from scratch with over 40,000 lines of code written in C++. I have implemented typical Battle Royale
                mechanics which includes joining lobby, dropping from aircraft, picking up loot, moving towards the safe zone, and surviving to be the last squad
                and winning the game. This project helped me get very thorough with Unreal Engine's <span class="font-semibold">Replication System</span>. Optimization
                was given top priority, I have ensured to send minimum data across the network to reduce latency, ensuring a smooth gameplay without compromising on
                quality. I have also implemented <span class="font-semibold">Lag Compensation</span> techniques such as <span class="font-semibold">Server Side Rewind</span>
                and <span class="font-semibold">Client Side Prediction</span>. It's a full game prototype with complete game loop.
            </p>
        </div>

        <!-- Showcase Video iframe -->
        <div class="flex flex-col w-full items-center overflow-hidden">

            <iframe class="w-full md:w-3/4 h-auto" style="aspect-ratio: 16 / 9;"
                    src="https://www.youtube.com/embed/RNkyLvl2Png?si=c1JHIu0bcG4h9nHK" title="YouTube video player"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
            </iframe>
        </div>

        <h3 class="font-semibold text-xl mt-8 ">Gameplay Video</h3>
        <hr class="border-y border-gray-400 mb-2 mr-10">

        <!-- Gameplay Video iframe -->
        <div class="flex flex-col w-full items-center overflow-hidden">

            <iframe class="w-full mt-5 md:w-3/4 h-auto" style="aspect-ratio: 16 / 9;"
                    src="https://www.youtube.com/embed/iVs5SxsuLNA?si=gE8MtvOBQsfHIqIo" title="YouTube video player"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>

        <!-- Things Implemented Title -->
        <h1 class="text-2xl text-center font-bold mb-1 mt-5">Key Features and Mechanics</h1>
        <hr class="border-y border-gray-400">

        <!-- Implementations List -->
        <div class="flex flex-col items-center w-full my-5">

            <div class="grid grid-cols-2 gap-1">
                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Replicated Weapon Mechanics</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Inventory System</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Armour</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Hitbox based Weighted Damage</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Grenade, Smoke Grenade</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Vaulting</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Solo, Duo, Trio, Squad</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Knock Player</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Revive Player</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Eliminate Enemy and Team</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Win/Lose Match</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Death Box</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Server Side Rewind</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Client Side Prediction</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Blue Zone, Safe Zone</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Randomly generated Zone and Flight Path</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Zone Damage and Effects</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Weighted Random based Loot Generation</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Jump from Aircraft</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Skydive, Falling</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Parachute, Glide</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>MiniMap and FullMap Widgets</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Steam SDK</p>
                </div>

                <div class="bg-blue-100 p-2 rounded-lg shadow-xl">
                    <p>Create, Join, Configure Sessions</p>
                </div>
            </div>
        </div>

        <!-- Project Overview Title -->
        <h1 class="text-2xl text-center font-bold mb-1">Project Overview</h1>
        <hr class="border-y border-gray-400 mb-2">

        <!-- General Overview -->
        <h3 class="font-semibold text-xl mt-5 ">Objective of the Project</h3>
        <hr class="border-y border-gray-400 mb-2 mr-10">

        <p>
            I enjoy building large, complex projects because they offer more challenges, not only in programming mechanics but also in maintaining a large codebase.
            I always prioritize careful planning before implementation, ensuring that adding new features in the future will be hassle-free. By taking the time to plan
            properly and implement mechanics with thorough testing, I was able to deliver a final prototype with minimal issues and no game-breaking bugs.
            <span class="font-semibold">Decoupling</span> features into components was crucial for enabling rapid feature additions and making maintenance
            and testing more efficient.<br><br>

            This project also made me realize the importance of testing. Spending time to create tools or mechanics for testing proved highly productive and saved a lot of time.
            I developed a strong interest in testing as it requires innovative solutions to test unique mechanics quickly.<br><br>

            Optimization was a top priority throughout the project. I designed every system to be as efficient as possible, consuming minimal CPU cycles. I also focused on
            memory optimization, using appropriate data structures and clearing objects from memory when no longer needed. I carefully selected data types to minimize the
            amount of data sent over the network, and I found solutions to avoid transmitting unnecessary data.
        </p>

        <!-- Random Loot Generation -->
        <h3 class="font-semibold text-xl mt-5 ">Random Loot Generation</h3>
        <hr class="border-y border-gray-400 mb-2 mr-10">

        <p>
            Random loot generation is a crucial part in Battle Royale games. After looking through various approaches, I found <span class="font-semibold">Weight Random</span>
            choosing to be suitable since it gave more control by taking individual weights and total weight into account.
        </p>

        <!-- Sub heading - Random Loot Generation -->
        <h3 class="font-bold text-lg mt-5 ">Assigning Weights</h3>
        <p>
            Assigning weights was made easy by the use of <span class="font-semibold">DataTables</span>, so weights can be updated easily by modifying the DataTable, experimenting
            the Loot Generation is made easy this way. Following are the weights that I use currently.
        </p>

        <!-- Items Weights DataTable Image -->
        <div class="flex flex-col mt-5 w-full items-center">
            <img class="max-w-full md:w-3/4" src="/assets/images/portfolio/battle_royale/loot_gen_dt.png" alt="">
            <p class="font-semibold text-sm mt-2">[Fig 1] Item Weights DataTables</p>
        </div>

        <h3 class="font-bold text-lg mt-5">Working</h3>
        <p>
            LootSpawnActor is placed all around the map, when the game begins, the server gets all these LootSpawnActors placed in the world. Then based on choosing probability set in
            the blueprint, it either uses that LootSpawnActor for spawning loot otherwise it just destroys the LootSpawnActor. After that, it determines the number of loot items that
            need to be spawned in each of the chosen LootSpawnActors randomly ,and it can range upto 1 to 5 items.
            Next is determining the items to spawn.<br><br>

            First, <span class="font-semibold">ItemType</span> such as Ammo, Throwable, Armour, Weapon have weights, which is used to determine what kind of loot to spawn.
            Once that has been chosen, the next would be to choose the item of the previously chosen type, for which again weights can be found in the DataTable. By doing this,
            I have balanced the spawn rate of the item based on the necessity of the item in the game.<br><br>

            After choosing the items to spawn, logic is executed to spawn the chosen items. The LootSpawnActor is a plane, which is divided equally into 4 parts. Each chosen item
            is randomly spawned in any of the divided part, and placed at random rotation. The reason I have chosen this method is to save the server's CPU time. Since there are 1000s of
            LootSpawnActors in the world, doing complex calculations and trace testing will be costly. By <span class="font-semibold">profiling</span> the LootGeneration and spawning
            I found this method to be best, generating loot and spawning them in <span class="font-semibold">few hundred milliseconds</span>. <br><br>

            There is also additional logic, that ensures that when a weapon is spawned, the ammo for the weapons is also spawned along with it.
        </p>

        <!-- Random Loot Generation Image -->
        <div class="flex flex-col mt-5 w-full items-center">
            <img class="max-w-full md:w-1/2" src="/assets/images/portfolio/battle_royale/single_loot_spawn.gif" alt="">
            <p class="font-semibold text-sm mt-2">[Fig 2] Random Loot Generation</p>
        </div>

        <!-- Zone and Flight Path Generation -->
        <h3 class="font-semibold text-xl mt-5 ">Zone and Flight Path Generation</h3>
        <hr class="border-y border-gray-400 mb-2 mr-10">

        <p>
            Varying the flight path and the zone randomly every game which creates variability in the game. So every match doesn't feel the same. I came up with some solutions to do
            this effectively and they are highly customizable.
        </p>

        <h3 class="font-bold text-lg mt-5">Flight Path Generation</h3>
        
        <p>
            The flight need to spawn and move from any side of the map to another side which is on the opposite. To achieve this with maximum variability I have used a spline. Here is
            how the component responsible for generating the flight path works,
        </p>

        <ul class="list-disc pl-5">
            <li>
                There is a FlightPathActor, which has a spline with 5 points. The points of the spline need to be placed along the edges of the map, and it
                should form a closed loop, joining point 4 to point 0. Now we have a closed looped spline around the map.
            </li>
            <li>
                The component responsible for generating the flight path, takes this spline.
            </li>
            <li>
                First it chooses any two consecutive points randomly, for example let's say 1 and 2, which will give us a side of the spline.
            </li>
            <li>
                Next, it finds the opposite spline side by adding 2 to both the spline points [(1 + 2) % 4 = 3] and [(2 + 2) % 4 = 4]. So the other side would be the points 3 and 0.
            </li>
            <li>
                Since it has two opposites sides, it finds any random location along the spline sides.
            </li>
            <li>
                We can simply join these two location to get a flight path.
            </li>
        </ul>

        <!-- World Bounds Spline Image -->
        <div class="flex flex-col mt-5 w-full items-center">
            <img class="max-w-full md:w-3/4" src="/assets/images/portfolio/battle_royale/spline.jpg" alt="">
            <p class="font-semibold text-sm mt-2">[Fig 3] Spline looped around the map</p>
        </div>

        <h3 class="font-bold text-lg mt-5">Random Zone Location</h3>
        <p>
            The zone can be completely configured using a DataTable. It is possible to change things like Init delay (generally only set for the first zone), Blue Zone shrink start time,
            Blue Zone shrink time, Safe Zone diameter, Blue Zone Damage per second.
        </p>

        <h3 class="font-bold text-sm mt-5">Working</h3>
        <p>
            For determining the zone location, we again use the spline. Since the spline is a closed loop around the map, it can be used as bounds and points can be generated inside
            the bounds. The way it is generated is as follows,
        </p>
        <ul class="list-disc pl-5">
            <li>
                First the spline locations are taken and a polygon is constructed. The spline points are offset inwards to prevent zone clipping out of the map area.
            </li>
            <li>
                Depending on the current zone phase, the zone's diameter is obtained from the DataTable.
            </li>
            <li>
                For the first zone phase, a random point is found inside the polygon.
            </li>
            <li>
                For the other zone phases, we need to find a new circle inside the previous circle that was found, for that we can calculate the radius difference between
                the zone circle of previous and current phase, and then find a new point in circle created with the radius difference. That circle will surely be enclosed within
                the previous zone circle.
            </li>
        </ul>

        <!-- Zone Generation Image -->
        <div class="flex flex-col mt-5 w-full items-center">
            <img class="max-w-full md:w-3/5" src="/assets/images/portfolio/battle_royale/zone_gen.jpg" alt="">
            <p class="font-semibold text-sm mt-2">[Fig 4] Zone Generation</p>
        </div>

        <!-- Server Side Rewind -->
        <h3 class="font-semibold text-xl mt-5 ">Server Side Rewind</h3>
        <hr class="border-y border-gray-400 mb-2 mr-10">
        <p>
            The problem with multiplayer games is that, due to network latency, the time of shooting a bullet and the time this reaches the server for authentication and processing
            will be different. In low latency scenario, this might not mean much. But even with moderate latency, this can cause some discrepancies such as player getting hit and dying
            after reaching a cover. To fix this, Server Side Rewind can be used, where the server records data regarding hit boxes of the player in some regular intervals or every frame.
            So when a player fires a weapon, time of firing the weapon can also be sent along, which can be used to look through the history of the recorded hit box data and test if
            the shot is a hit or not. Though this can be a good way of ensuring accurate hit based on time, but for very high latency it may not look as intended in the gameplay, so it's
            best to turn off Server Side Rewind for very high latency.
        </p><br>

        <p>Below is how I have implemented Server Side Rewind in my project.</p>

        <ul class="list-disc pl-5">
            <li>
                Each player has multiple hit boxes which are box and capsule collisions attached to the character mesh.
            </li>
            <li>
                In the server machine, the hit box <span class="font-semibold">Transforms</span> are recorded each frame and stored in a <span>doubly linked list</span>.
            </li>
            <li>
                It is enough to keep records only for a 4 seconds window, other records can be discarded to save memory.
            </li>
            <li>
                When a client machine sends a weapon fire action along with time of fire to the server, the server can iterate through the doubly linked list on both sides,
                trying to find a record which was recorded at a time closest to the time of fire of the client.
            </li>
            <li>
                If we exactly find a node with the time of fire equal to the time at which the record was saved, we can use the data in the node. But this is a rare case.
            </li>
            <li>
                If we cannot find an exact match, then with the help of next and previous pointers we can find two nodes, one greater than the time of fire and another less than the
                time of fire. We can interpolate the data between these nodes to get an approximation of how the hit box would have been at that time.
            </li>
            <li>
                The data in the record would be the hit box transforms which we can trace test to see if the weapon fire is a hit or not.
            </li>
            <li>
                Based on the weapon type, which maybe hit-scan or projectile, relevant trace test is performed by moving the hit boxes to the Transforms stored in the record and performing
                the test, to determine if it's a hit or not.
            </li>
        </ul>

        <br>
        <p>
            In the below image, a projectile weapon is fired. We can see the green sphere which is a projectile trace, tested against a record that was found based on the time sent
            from the client. The chosen record is debugged and player is hidden for understanding.
        </p>

        <!-- Server Side Rewind Image -->
        <div class="flex flex-col mt-5 w-full items-center">
            <img class="max-w-full md:w-3/4" src="/assets/images/portfolio/battle_royale/ssr_hitbox.jpg" alt="">
            <p class="font-semibold text-sm mt-2">[Fig 5] Record at time of hit Debugged</p>
        </div>

        <br><br>
    </div>
</div>

<!-- Scroll to top button -->
<button id="scrollToTopBtn" style="opacity: 0; pointer-events: none; transition: opacity 0.5s;" onclick="scrollToTop()"
        class="fixed bottom-10 right-10 bg-black text-white font-bold py-2 px-4 rounded-full hover:bg-gray-700">
    <i class="fa-solid fa-arrow-up"></i>
</button>

<footer class="bg-black text-white p-4 mt-auto w-full">
    <div class="container mx-auto text-center">
        <p class="text-sm">© 2024 Rishi Khanna. All rights reserved.</p>
    </div>
</footer>

</body>
</html>